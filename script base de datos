-- =============================================
-- SECCIÓN 1: DROP TABLES (Para limpieza previa)
-- =============================================

BEGIN EXECUTE IMMEDIATE 'DROP TABLE CONFIGURACION_SISTEMA CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE API_REQUESTS_LOG CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE API_KEYS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE INFORMES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE SUSCRIPCIONES_NEWSLETTER CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CONTACTOS_CLIENTE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PRODUCTOS_PROMOCION CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PROMOCIONES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE SEGUIMIENTO_ENVIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE ENVIOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE TRANSPORTISTAS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE EMPRESA_TRANSPORTE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE DETALLES_DEVOLUCION CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE DEVOLUCIONES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE WEBPAY_TRANSACCIONES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PAGOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE DOCUMENTOS_TRIBUTARIOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE HISTORICO_ESTADOS_PEDIDO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE DETALLES_PEDIDO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PEDIDOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE MOVIMIENTOS_INVENTARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE INVENTARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE HISTORIAL_PRECIOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PRODUCTOS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PROVEEDORES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE MARCAS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CATEGORIAS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE TIPOS_CAMBIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE DIVISAS CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE HISTORIAL_SESIONES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CONTADOR CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE BODEGUERO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE VENDEDOR CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE ADMINISTRADOR CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CLIENTE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE PERMISOS_ROLE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE ROLES_USUARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE ROLES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CREDENCIALES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE USUARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE SUCURSALES CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

-- =============================================
-- SECCIÓN 2: CREACIÓN DE TABLAS PRINCIPALES
-- =============================================

-- ESTRATEGIA DE MODELADO:
-- 1. Crear las tablas agrupadas por dominio funcional
-- 2. Agregar las relaciones esenciales al final
-- 3. Evitar relaciones redundantes y ciclos

-- ---------------------------------------------
-- DOMINIO: ESTRUCTURA ORGANIZACIONAL
-- ---------------------------------------------

-- Tabla: SUCURSALES
CREATE TABLE SUCURSALES (
    ID_Sucursal NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Direccion VARCHAR2(200) NOT NULL,
    Ciudad VARCHAR2(50) NOT NULL,
    Region VARCHAR2(50) NOT NULL,
    Telefono VARCHAR2(20),
    Email VARCHAR2(100),
    Horario_Atencion VARCHAR2(200),
    Estado VARCHAR2(20) CHECK (Estado IN ('Activa', 'Inactiva')),
    Latitud NUMBER(10,6),
    Longitud NUMBER(10,6)
);

-- ---------------------------------------------
-- DOMINIO: USUARIOS Y PERSONAL
-- ---------------------------------------------

-- Tabla: USUARIO (Base para todos los tipos de usuarios)
CREATE TABLE USUARIO (
    ID_Usuario NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Email VARCHAR2(100) UNIQUE NOT NULL,
    RUT VARCHAR2(20) UNIQUE,
    Telefono VARCHAR2(20),
    Direccion VARCHAR2(200),
    Ciudad VARCHAR2(50),
    Region VARCHAR2(50),
    Estado VARCHAR2(20) CHECK (Estado IN ('Activo', 'Inactivo', 'Suspendido')),
    Fecha_Registro DATE DEFAULT SYSDATE NOT NULL,
    Ultima_Actualizacion DATE DEFAULT SYSDATE
);

-- Tabla: CREDENCIALES (Separado de USUARIO para seguridad)
CREATE TABLE CREDENCIALES (
    ID_Credencial NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    Username VARCHAR2(50) UNIQUE NOT NULL,
    Password_Hash VARCHAR2(255) NOT NULL,
    Primer_Inicio NUMBER(1) DEFAULT 1,
    Fecha_Ultimo_Cambio DATE DEFAULT SYSDATE,
    Fecha_Expiracion DATE
);

-- Tabla: ROLES
CREATE TABLE ROLES (
    ID_Role NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(50) NOT NULL UNIQUE,
    Descripcion VARCHAR2(200)
);

-- Tabla: ROLES_USUARIO
CREATE TABLE ROLES_USUARIO (
    ID_Role_Usuario NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    ID_Role NUMBER(10) NOT NULL,
    Fecha_Asignacion DATE DEFAULT SYSDATE,
    CONSTRAINT uk_usuario_role UNIQUE (ID_Usuario, ID_Role)
);

-- Tabla: PERMISOS_ROLE
CREATE TABLE PERMISOS_ROLE (
    ID_Permiso_Role NUMBER(10) PRIMARY KEY,
    ID_Role NUMBER(10) NOT NULL,
    Modulo VARCHAR2(50) NOT NULL,
    Accion VARCHAR2(50) NOT NULL,
    CONSTRAINT uk_role_modulo_accion UNIQUE (ID_Role, Modulo, Accion)
);

-- Tabla: CLIENTE
CREATE TABLE CLIENTE (
    ID_Cliente NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    Tipo_Cliente VARCHAR2(20) DEFAULT 'Regular' CHECK (Tipo_Cliente IN ('Regular', 'Preferente', 'Corporativo')),
    Suscrito_Newsletter NUMBER(1) DEFAULT 0,
    Limite_Credito NUMBER(10,2) DEFAULT 0
);

-- Tabla: ADMINISTRADOR
CREATE TABLE ADMINISTRADOR (
    ID_Administrador NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    Fecha_Contratacion DATE,
    Nivel_Acceso VARCHAR2(20) CHECK (Nivel_Acceso IN ('Local', 'Regional', 'Nacional'))
);

-- Tabla: VENDEDOR
CREATE TABLE VENDEDOR (
    ID_Vendedor NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    ID_Sucursal NUMBER(10) NOT NULL,
    Codigo_Vendedor VARCHAR2(20) UNIQUE,
    Meta_Ventas NUMBER(10,2)
);

-- Tabla: BODEGUERO
CREATE TABLE BODEGUERO (
    ID_Bodeguero NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    ID_Sucursal NUMBER(10) NOT NULL,
    Area_Asignada VARCHAR2(50)
);

-- Tabla: CONTADOR
CREATE TABLE CONTADOR (
    ID_Contador NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    Certificacion VARCHAR2(100)
);

-- Tabla: HISTORIAL_SESIONES
CREATE TABLE HISTORIAL_SESIONES (
    ID_Sesion NUMBER(10) PRIMARY KEY,
    ID_Usuario NUMBER(10) NOT NULL,
    Fecha_Inicio DATE NOT NULL,
    Fecha_Fin DATE,
    Direccion_IP VARCHAR2(50),
    Dispositivo VARCHAR2(100)
);

-- ---------------------------------------------
-- DOMINIO: CATÁLOGO DE PRODUCTOS
-- ---------------------------------------------

-- Tabla: DIVISAS
CREATE TABLE DIVISAS (
    ID_Divisa NUMBER(10) PRIMARY KEY,
    Codigo VARCHAR2(10) NOT NULL UNIQUE,
    Nombre VARCHAR2(50) NOT NULL,
    Simbolo VARCHAR2(5) NOT NULL,
    Es_Default NUMBER(1) DEFAULT 0
);

-- Tabla: TIPOS_CAMBIO
CREATE TABLE TIPOS_CAMBIO (
    ID_Tipo_Cambio NUMBER(10) PRIMARY KEY,
    ID_Divisa_Origen NUMBER(10) NOT NULL,
    ID_Divisa_Destino NUMBER(10) NOT NULL,
    Fecha DATE NOT NULL,
    Tasa_Cambio NUMBER(14,6) NOT NULL,
    Fuente VARCHAR2(100) DEFAULT 'Banco Central de Chile',
    CONSTRAINT uk_divisas_fecha UNIQUE (ID_Divisa_Origen, ID_Divisa_Destino, Fecha)
);

-- Tabla: CATEGORIAS
CREATE TABLE CATEGORIAS (
    ID_Categoria NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Descripcion VARCHAR2(500),
    ID_Categoria_Padre NUMBER(10),
    Nivel NUMBER(1) NOT NULL,
    Icono_URL VARCHAR2(255),
    Orden_Visualizacion NUMBER(3)
);

-- Tabla: MARCAS
CREATE TABLE MARCAS (
    ID_Marca NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Descripcion VARCHAR2(500),
    Logo_URL VARCHAR2(255),
    Pais_Origen VARCHAR2(50),
    Sitio_Web VARCHAR2(255)
);

-- Tabla: PROVEEDORES
CREATE TABLE PROVEEDORES (
    ID_Proveedor NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    RUT VARCHAR2(20) UNIQUE NOT NULL,
    Contacto_Nombre VARCHAR2(100),
    Contacto_Email VARCHAR2(100),
    Contacto_Telefono VARCHAR2(20),
    Direccion VARCHAR2(200),
    Pais VARCHAR2(50),
    Tiempo_Entrega_Promedio NUMBER(5),
    Condiciones_Pago VARCHAR2(200)
);

-- Tabla: PRODUCTOS
CREATE TABLE PRODUCTOS (
    ID_Producto NUMBER(10) PRIMARY KEY,
    Codigo VARCHAR2(20) UNIQUE NOT NULL,
    Nombre VARCHAR2(150) NOT NULL,
    Descripcion VARCHAR2(1000),
    Especificaciones CLOB,
    ID_Categoria NUMBER(10) NOT NULL,
    ID_Marca NUMBER(10) NOT NULL,
    ID_Proveedor NUMBER(10),
    Codigo_Proveedor VARCHAR2(50),
    ID_Divisa NUMBER(10) NOT NULL,
    Precio_Compra NUMBER(10,2),
    Precio_Venta NUMBER(10,2) NOT NULL,
    Descuento_Maximo NUMBER(5,2),
    Tasa_Impuesto NUMBER(5,2) DEFAULT 19,
    Peso NUMBER(8,2),
    Dimensiones VARCHAR2(50),
    Imagen_URL VARCHAR2(255),
    Destacado NUMBER(1) DEFAULT 0,
    Estado VARCHAR2(20) CHECK (Estado IN ('Activo', 'Inactivo', 'Descontinuado')),
    Fecha_Creacion DATE DEFAULT SYSDATE NOT NULL,
    Ultima_Actualizacion DATE DEFAULT SYSDATE
);

-- Tabla: HISTORIAL_PRECIOS
CREATE TABLE HISTORIAL_PRECIOS (
    ID_Historial NUMBER(10) PRIMARY KEY,
    ID_Producto NUMBER(10) NOT NULL,
    Precio_Anterior NUMBER(10,2),
    Precio_Nuevo NUMBER(10,2) NOT NULL,
    ID_Divisa NUMBER(10) NOT NULL,
    Fecha_Cambio DATE NOT NULL,
    ID_Administrador NUMBER(10),
    Motivo VARCHAR2(200)
);

-- ---------------------------------------------
-- DOMINIO: INVENTARIO
-- ---------------------------------------------

-- Tabla: INVENTARIO
CREATE TABLE INVENTARIO (
    ID_Inventario NUMBER(10) PRIMARY KEY,
    ID_Producto NUMBER(10) NOT NULL,
    ID_Sucursal NUMBER(10) NOT NULL,
    Stock_Actual NUMBER(10) DEFAULT 0 NOT NULL,
    Stock_Minimo NUMBER(10) DEFAULT 0 NOT NULL,
    Stock_Maximo NUMBER(10),
    Stock_Reservado NUMBER(10) DEFAULT 0 NOT NULL,
    Punto_Reorden NUMBER(10),
    Ubicacion_Almacen VARCHAR2(50),
    Ultima_Actualizacion DATE DEFAULT SYSDATE,
    ID_Bodeguero NUMBER(10),
    CONSTRAINT uk_inventario_producto_sucursal UNIQUE (ID_Producto, ID_Sucursal)
);

-- Tabla: MOVIMIENTOS_INVENTARIO
CREATE TABLE MOVIMIENTOS_INVENTARIO (
    ID_Movimiento NUMBER(10) PRIMARY KEY,
    ID_Inventario NUMBER(10) NOT NULL,
    Tipo_Movimiento VARCHAR2(30) CHECK (Tipo_Movimiento IN ('Entrada', 'Salida', 'Ajuste', 'Reserva', 'Transferencia')),
    Cantidad NUMBER(10) NOT NULL,
    Fecha DATE DEFAULT SYSDATE,
    ID_Pedido NUMBER(10),
    ID_Devolucion NUMBER(10),
    ID_Bodeguero NUMBER(10),
    Comentario VARCHAR2(500),
    ID_Sucursal_Destino NUMBER(10)
);

-- ---------------------------------------------
-- DOMINIO: VENTAS Y PEDIDOS
-- ---------------------------------------------

-- Tabla: PEDIDOS
CREATE TABLE PEDIDOS (
    ID_Pedido NUMBER(10) PRIMARY KEY,
    Codigo_Pedido VARCHAR2(20) UNIQUE NOT NULL,
    ID_Cliente NUMBER(10) NOT NULL,
    ID_Vendedor NUMBER(10),
    ID_Sucursal NUMBER(10) NOT NULL,
    Fecha_Pedido DATE DEFAULT SYSDATE NOT NULL,
    Canal VARCHAR2(20) CHECK (Canal IN ('Online', 'Físico')),
    Estado VARCHAR2(30) CHECK (Estado IN ('Pendiente', 'Aprobado', 'En_Preparacion', 'Listo_Para_Entrega', 'En_Ruta', 'Entregado', 'Cancelado', 'Devuelto')),
    Metodo_Entrega VARCHAR2(20) CHECK (Metodo_Entrega IN ('Retiro_Tienda', 'Despacho_Domicilio')),
    Direccion_Entrega VARCHAR2(200),
    Ciudad_Entrega VARCHAR2(50),
    Region_Entrega VARCHAR2(50),
    Pais_Entrega VARCHAR2(50) DEFAULT 'Chile',
    Comentarios VARCHAR2(500),
    Subtotal NUMBER(10,2) NOT NULL,
    Descuento NUMBER(10,2) DEFAULT 0 NOT NULL,
    Impuestos NUMBER(10,2) DEFAULT 0 NOT NULL,
    Costo_Envio NUMBER(10,2) DEFAULT 0 NOT NULL,
    Total NUMBER(10,2) NOT NULL,
    ID_Divisa NUMBER(10) NOT NULL,
    Fecha_Estimada_Entrega DATE,
    Prioridad VARCHAR2(20) DEFAULT 'Normal' CHECK (Prioridad IN ('Baja', 'Normal', 'Alta', 'Urgente'))
);

-- Tabla: DETALLES_PEDIDO
CREATE TABLE DETALLES_PEDIDO (
    ID_Detalle NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    ID_Producto NUMBER(10) NOT NULL,
    Cantidad NUMBER(10) NOT NULL,
    Precio_Unitario NUMBER(10,2) NOT NULL,
    Descuento NUMBER(10,2) DEFAULT 0 NOT NULL,
    Impuesto NUMBER(10,2) DEFAULT 0 NOT NULL,
    Subtotal NUMBER(10,2) NOT NULL,
    Estado VARCHAR2(20) CHECK (Estado IN ('Pendiente', 'Preparado', 'Entregado', 'Devuelto'))
);

-- Tabla: HISTORICO_ESTADOS_PEDIDO
CREATE TABLE HISTORICO_ESTADOS_PEDIDO (
    ID_Historico NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    Estado_Anterior VARCHAR2(30),
    Estado_Nuevo VARCHAR2(30) NOT NULL,
    Fecha_Cambio DATE DEFAULT SYSDATE NOT NULL,
    ID_Usuario NUMBER(10) NOT NULL,
    Comentario VARCHAR2(500)
);

-- Tabla: DOCUMENTOS_TRIBUTARIOS
CREATE TABLE DOCUMENTOS_TRIBUTARIOS (
    ID_Documento NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    Tipo_Documento VARCHAR2(20) CHECK (Tipo_Documento IN ('Factura', 'Boleta')),
    Numero_Documento VARCHAR2(20) NOT NULL,
    Fecha_Emision DATE DEFAULT SYSDATE NOT NULL,
    RUT_Emisor VARCHAR2(20) NOT NULL,
    RUT_Receptor VARCHAR2(20),
    Razon_Social_Receptor VARCHAR2(200),
    Giro_Receptor VARCHAR2(100),
    Direccion_Receptor VARCHAR2(200),
    Subtotal NUMBER(10,2) NOT NULL,
    Impuestos NUMBER(10,2) NOT NULL,
    Total NUMBER(10,2) NOT NULL,
    ID_Divisa NUMBER(10) NOT NULL,
    URL_Documento VARCHAR2(255),
    ID_Contador NUMBER(10)
);

-- Tabla: PAGOS
CREATE TABLE PAGOS (
    ID_Pago NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    Fecha_Pago DATE DEFAULT SYSDATE NOT NULL,
    Metodo_Pago VARCHAR2(20) CHECK (Metodo_Pago IN ('Efectivo', 'Débito', 'Crédito', 'Transferencia')),
    Procesador_Pago VARCHAR2(50),
    Numero_Transaccion VARCHAR2(100),
    Monto NUMBER(10,2) NOT NULL,
    ID_Divisa NUMBER(10) NOT NULL,
    Estado VARCHAR2(20) CHECK (Estado IN ('Pendiente', 'Completado', 'Rechazado', 'Reembolsado')),
    ID_Contador NUMBER(10),
    Comprobante_URL VARCHAR2(255),
    Numero_Cuotas NUMBER(2) DEFAULT 1,
    Observaciones VARCHAR2(500)
);

-- Tabla: WEBPAY_TRANSACCIONES
CREATE TABLE WEBPAY_TRANSACCIONES (
    ID_Webpay_Transaccion NUMBER(10) PRIMARY KEY,
    ID_Pago NUMBER(10) NOT NULL,
    Token_Webpay VARCHAR2(100) NOT NULL,
    Orden_Compra VARCHAR2(50),
    Tarjeta_Tipo VARCHAR2(20),
    Tarjeta_Numero VARCHAR2(20),
    Autorizacion_Codigo VARCHAR2(50),
    Respuesta_Codigo VARCHAR2(20),
    Respuesta_Descripcion VARCHAR2(200),
    Fecha_Transaccion DATE DEFAULT SYSDATE NOT NULL,
    Installments NUMBER(10) DEFAULT 1,
    JSON_Respuesta CLOB
);

-- ---------------------------------------------
-- DOMINIO: DEVOLUCIONES
-- ---------------------------------------------

-- Tabla: DEVOLUCIONES
CREATE TABLE DEVOLUCIONES (
    ID_Devolucion NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    ID_Cliente NUMBER(10) NOT NULL,
    ID_Vendedor NUMBER(10),
    Fecha_Solicitud DATE DEFAULT SYSDATE NOT NULL,
    Motivo VARCHAR2(200) NOT NULL,
    Descripcion_Detallada VARCHAR2(1000),
    Tipo_Solucion VARCHAR2(20) CHECK (Tipo_Solucion IN ('Cambio', 'Reembolso')),
    Estado VARCHAR2(20) CHECK (Estado IN ('Solicitada', 'En_Proceso', 'Aprobada', 'Rechazada', 'Completada')),
    Fecha_Resolucion DATE,
    Comentarios_Internos VARCHAR2(500)
);

-- Tabla: DETALLES_DEVOLUCION
CREATE TABLE DETALLES_DEVOLUCION (
    ID_Detalle_Devolucion NUMBER(10) PRIMARY KEY,
    ID_Devolucion NUMBER(10) NOT NULL,
    ID_Detalle_Pedido NUMBER(10) NOT NULL,
    Cantidad NUMBER(10) NOT NULL,
    Motivo_Detallado VARCHAR2(200),
    Estado_Producto VARCHAR2(20) CHECK (Estado_Producto IN ('Nuevo', 'Usado', 'Dañado', 'Incompleto')),
    Monto_Devuelto NUMBER(10,2),
    ID_Producto_Reemplazo NUMBER(10)
);

-- ---------------------------------------------
-- DOMINIO: LOGÍSTICA Y ENTREGAS
-- ---------------------------------------------

-- Tabla: EMPRESA_TRANSPORTE
CREATE TABLE EMPRESA_TRANSPORTE (
    ID_Empresa NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    RUT VARCHAR2(20) UNIQUE NOT NULL,
    Contacto_Nombre VARCHAR2(100),
    Contacto_Email VARCHAR2(100),
    Contacto_Telefono VARCHAR2(20),
    Direccion VARCHAR2(200),
    Ciudad VARCHAR2(50),
    Pais VARCHAR2(50) DEFAULT 'Chile',
    Sitio_Web VARCHAR2(255),
    Cobertura_Internacional NUMBER(1) DEFAULT 0,
    API_Integracion_URL VARCHAR2(255)
);

-- Tabla: TRANSPORTISTAS
CREATE TABLE TRANSPORTISTAS (
    ID_Transportista NUMBER(10) PRIMARY KEY,
    ID_Empresa NUMBER(10) NOT NULL,
    Nombre VARCHAR2(100) NOT NULL,
    RUT VARCHAR2(20) UNIQUE NOT NULL,
    Telefono VARCHAR2(20),
    Email VARCHAR2(100),
    Vehiculo_Tipo VARCHAR2(50),
    Vehiculo_Patente VARCHAR2(20)
);

-- Tabla: ENVIOS
CREATE TABLE ENVIOS (
    ID_Envio NUMBER(10) PRIMARY KEY,
    ID_Pedido NUMBER(10) NOT NULL,
    ID_Transportista NUMBER(10),
    Tipo_Envio VARCHAR2(20) CHECK (Tipo_Envio IN ('Nacional', 'Internacional', 'Normal', 'Prioritario', 'Mismo_Dia')),
    Fecha_Programada DATE,
    Fecha_Recogida DATE,
    Fecha_Entrega_Estimada DATE,
    Fecha_Entrega_Real DATE,
    Estado VARCHAR2(20) CHECK (Estado IN ('Pendiente', 'Recogido', 'En_Ruta', 'Entregado', 'Fallido', 'Reprogramado')),
    Codigo_Seguimiento VARCHAR2(50),
    URL_Seguimiento VARCHAR2(255),
    Instrucciones_Especiales VARCHAR2(500),
    Receptor_Nombre VARCHAR2(100),
    Receptor_Documento VARCHAR2(20)
);

-- Tabla: SEGUIMIENTO_ENVIO
CREATE TABLE SEGUIMIENTO_ENVIO (
    ID_Seguimiento NUMBER(10) PRIMARY KEY,
    ID_Envio NUMBER(10) NOT NULL,
    Fecha DATE DEFAULT SYSDATE NOT NULL,
    Estado VARCHAR2(50) NOT NULL,
    Descripcion VARCHAR2(500),
    Ubicacion VARCHAR2(200),
    Latitud NUMBER(10,6),
    Longitud NUMBER(10,6),
    ID_Transportista NUMBER(10)
);

-- ---------------------------------------------
-- DOMINIO: MARKETING Y PROMOCIONES
-- ---------------------------------------------

-- Tabla: PROMOCIONES
CREATE TABLE PROMOCIONES (
    ID_Promocion NUMBER(10) PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Descripcion VARCHAR2(500),
    Tipo VARCHAR2(30) CHECK (Tipo IN ('Descuento_Porcentaje', 'Descuento_Monto', 'NxM', 'Regalo')),
    Valor NUMBER(10,2),
    Fecha_Inicio DATE NOT NULL,
    Fecha_Fin DATE NOT NULL,
    Cantidad_Minima NUMBER(10) DEFAULT 4,
    ID_Categoria NUMBER(10),
    Codigo_Promocion VARCHAR2(20),
    Estado VARCHAR2(20) CHECK (Estado IN ('Activa', 'Inactiva', 'Programada', 'Finalizada')),
    ID_Administrador NUMBER(10) NOT NULL,
    Aplica_Online NUMBER(1) DEFAULT 1,
    Aplica_Tienda NUMBER(1) DEFAULT 1,
    Excluye_Promociones NUMBER(1) DEFAULT 1
);

-- Tabla: PRODUCTOS_PROMOCION
CREATE TABLE PRODUCTOS_PROMOCION (
    ID_Producto_Promocion NUMBER(10) PRIMARY KEY,
    ID_Promocion NUMBER(10) NOT NULL,
    ID_Producto NUMBER(10) NOT NULL,
    Descuento_Especial NUMBER(10,2),
    Regla_Adicional VARCHAR2(200),
    CONSTRAINT uk_promocion_producto UNIQUE (ID_Promocion, ID_Producto)
);

-- Tabla: CONTACTOS_CLIENTE
CREATE TABLE CONTACTOS_CLIENTE (
    ID_Contacto NUMBER(10) PRIMARY KEY,
    ID_Cliente NUMBER(10),
    Nombre VARCHAR2(100) NOT NULL,
    Email VARCHAR2(100) NOT NULL,
    Telefono VARCHAR2(20),
    Asunto VARCHAR2(100) NOT NULL,
    Mensaje VARCHAR2(1000) NOT NULL,
    Fecha_Contacto DATE DEFAULT SYSDATE NOT NULL,
    Estado VARCHAR2(20) CHECK (Estado IN ('Pendiente', 'En_Proceso', 'Respondido', 'Cerrado')),
    ID_Vendedor NUMBER(10),
    Respuesta VARCHAR2(1000),
    Fecha_Respuesta DATE,
    Evaluacion NUMBER(1)
);

-- Tabla: SUSCRIPCIONES_NEWSLETTER
CREATE TABLE SUSCRIPCIONES_NEWSLETTER (
    ID_Suscripcion NUMBER(10) PRIMARY KEY,
    Email VARCHAR2(100) NOT NULL UNIQUE,
    Nombre VARCHAR2(100),
    ID_Cliente NUMBER(10),
    Fecha_Suscripcion DATE DEFAULT SYSDATE NOT NULL,
    Estado VARCHAR2(20) DEFAULT 'Activa' CHECK (Estado IN ('Activa', 'Cancelada')),
    Preferencias VARCHAR2(200),
    Token_Confirmacion VARCHAR2(100),
    Fecha_Confirmacion DATE
);

-- ---------------------------------------------
-- DOMINIO: API Y SISTEMA
-- ---------------------------------------------

-- Tabla: INFORMES
CREATE TABLE INFORMES (
    ID_Informe NUMBER(10) PRIMARY KEY,
    Tipo VARCHAR2(20) CHECK (Tipo IN ('Ventas', 'Desempeño', 'Inventario', 'Financiero')),
    Titulo VARCHAR2(100) NOT NULL,
    Descripcion VARCHAR2(500),
    Fecha_Generacion DATE DEFAULT SYSDATE NOT NULL,
    ID_Administrador NUMBER(10) NOT NULL,
    ID_Sucursal NUMBER(10),
    Periodo_Inicio DATE,
    Periodo_Fin DATE,
    Parametros VARCHAR2(1000),
    Formato VARCHAR2(20) CHECK (Formato IN ('PDF', 'Excel', 'CSV', 'HTML')),
    URL_Documento VARCHAR2(255),
    Estado VARCHAR2(20) DEFAULT 'Generado' CHECK (Estado IN ('Generado', 'Enviado', 'Archivado'))
);

-- Tabla: API_KEYS
CREATE TABLE API_KEYS (
    ID_API_Key NUMBER(10) PRIMARY KEY,
    Clave VARCHAR2(100) NOT NULL UNIQUE,
    Descripcion VARCHAR2(200),
    Tipo_Cliente VARCHAR2(20) CHECK (Tipo_Cliente IN ('Interno', 'Externo')),
    ID_Sucursal NUMBER(10),
    Nombre_Tienda VARCHAR2(100),
    Email_Contacto VARCHAR2(100) NOT NULL,
    Fecha_Creacion DATE DEFAULT SYSDATE NOT NULL,
    Fecha_Expiracion DATE,
    Estado VARCHAR2(20) DEFAULT 'Activa' CHECK (Estado IN ('Activa', 'Inactiva', 'Revocada')),
    Permisos VARCHAR2(500),
    Limite_Peticiones_Diarias NUMBER(10),
    IP_Permitidas VARCHAR2(500)
);

-- Tabla: API_REQUESTS_LOG
CREATE TABLE API_REQUESTS_LOG (
    ID_Log NUMBER(10) PRIMARY KEY,
    ID_API_Key NUMBER(10),
    Endpoint VARCHAR2(100) NOT NULL,
    Metodo VARCHAR2(10) NOT NULL,
    IP VARCHAR2(50) NOT NULL,
    Fecha_Peticion TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    Estado_Respuesta NUMBER(10) NOT NULL,
    Tiempo_Respuesta NUMBER(10),
    Payload CLOB,
    Respuesta CLOB,
    User_Agent VARCHAR2(255)
);

-- Tabla: CONFIGURACION_SISTEMA
CREATE TABLE CONFIGURACION_SISTEMA (
    ID_Configuracion NUMBER(10) PRIMARY KEY,
    Categoria VARCHAR2(50) NOT NULL,
    Clave VARCHAR2(100) NOT NULL,
    Valor VARCHAR2(500) NOT NULL,
    Descripcion VARCHAR2(500),
    Modificable NUMBER(1) DEFAULT 1,
    Ultima_Modificacion DATE DEFAULT SYSDATE,
    ID_Administrador NUMBER(10),
    CONSTRAINT uk_categoria_clave UNIQUE (Categoria, Clave)
);

-- =============================================
-- SECCIÓN 3: AGREGAR RELACIONES CRÍTICAS
-- =============================================

-- Solo agregamos las relaciones más importantes que definen el flujo
-- principal y la integridad referencial básica del sistema

-- RELACIONES DE USUARIO
ALTER TABLE CREDENCIALES ADD CONSTRAINT fk_credencial_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE ROLES_USUARIO ADD CONSTRAINT fk_roleusuario_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE ROLES_USUARIO ADD CONSTRAINT fk_roleusuario_role FOREIGN KEY (ID_Role) REFERENCES ROLES(ID_Role);
ALTER TABLE PERMISOS_ROLE ADD CONSTRAINT fk_permiso_role FOREIGN KEY (ID_Role) REFERENCES ROLES(ID_Role);
ALTER TABLE CLIENTE ADD CONSTRAINT fk_cliente_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE ADMINISTRADOR ADD CONSTRAINT fk_admin_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE VENDEDOR ADD CONSTRAINT fk_vendedor_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE VENDEDOR ADD CONSTRAINT fk_vendedor_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE BODEGUERO ADD CONSTRAINT fk_bodeguero_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE BODEGUERO ADD CONSTRAINT fk_bodeguero_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE CONTADOR ADD CONSTRAINT fk_contador_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE HISTORIAL_SESIONES ADD CONSTRAINT fk_sesion_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);

-- RELACIONES DE CATÁLOGO
ALTER TABLE CATEGORIAS ADD CONSTRAINT fk_categoria_padre FOREIGN KEY (ID_Categoria_Padre) REFERENCES CATEGORIAS(ID_Categoria);
ALTER TABLE TIPOS_CAMBIO ADD CONSTRAINT fk_tipocambio_origen FOREIGN KEY (ID_Divisa_Origen) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE TIPOS_CAMBIO ADD CONSTRAINT fk_tipocambio_destino FOREIGN KEY (ID_Divisa_Destino) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE PRODUCTOS ADD CONSTRAINT fk_producto_categoria FOREIGN KEY (ID_Categoria) REFERENCES CATEGORIAS(ID_Categoria);
ALTER TABLE PRODUCTOS ADD CONSTRAINT fk_producto_marca FOREIGN KEY (ID_Marca) REFERENCES MARCAS(ID_Marca);
ALTER TABLE PRODUCTOS ADD CONSTRAINT fk_producto_proveedor FOREIGN KEY (ID_Proveedor) REFERENCES PROVEEDORES(ID_Proveedor);
ALTER TABLE PRODUCTOS ADD CONSTRAINT fk_producto_divisa FOREIGN KEY (ID_Divisa) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE HISTORIAL_PRECIOS ADD CONSTRAINT fk_historial_producto FOREIGN KEY (ID_Producto) REFERENCES PRODUCTOS(ID_Producto);
ALTER TABLE HISTORIAL_PRECIOS ADD CONSTRAINT fk_historial_divisa FOREIGN KEY (ID_Divisa) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE HISTORIAL_PRECIOS ADD CONSTRAINT fk_historial_admin FOREIGN KEY (ID_Administrador) REFERENCES ADMINISTRADOR(ID_Administrador);

-- RELACIONES DE INVENTARIO
ALTER TABLE INVENTARIO ADD CONSTRAINT fk_inventario_producto FOREIGN KEY (ID_Producto) REFERENCES PRODUCTOS(ID_Producto);
ALTER TABLE INVENTARIO ADD CONSTRAINT fk_inventario_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE INVENTARIO ADD CONSTRAINT fk_inventario_bodeguero FOREIGN KEY (ID_Bodeguero) REFERENCES BODEGUERO(ID_Bodeguero);
ALTER TABLE MOVIMIENTOS_INVENTARIO ADD CONSTRAINT fk_movimiento_inventario FOREIGN KEY (ID_Inventario) REFERENCES INVENTARIO(ID_Inventario);
ALTER TABLE MOVIMIENTOS_INVENTARIO ADD CONSTRAINT fk_movimiento_bodeguero FOREIGN KEY (ID_Bodeguero) REFERENCES BODEGUERO(ID_Bodeguero);
ALTER TABLE MOVIMIENTOS_INVENTARIO ADD CONSTRAINT fk_movimiento_sucursal FOREIGN KEY (ID_Sucursal_Destino) REFERENCES SUCURSALES(ID_Sucursal);

-- RELACIONES DE VENTAS
ALTER TABLE PEDIDOS ADD CONSTRAINT fk_pedido_cliente FOREIGN KEY (ID_Cliente) REFERENCES CLIENTE(ID_Cliente);
ALTER TABLE PEDIDOS ADD CONSTRAINT fk_pedido_vendedor FOREIGN KEY (ID_Vendedor) REFERENCES VENDEDOR(ID_Vendedor);
ALTER TABLE PEDIDOS ADD CONSTRAINT fk_pedido_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE PEDIDOS ADD CONSTRAINT fk_pedido_divisa FOREIGN KEY (ID_Divisa) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE DETALLES_PEDIDO ADD CONSTRAINT fk_detalle_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE DETALLES_PEDIDO ADD CONSTRAINT fk_detalle_producto FOREIGN KEY (ID_Producto) REFERENCES PRODUCTOS(ID_Producto);
ALTER TABLE HISTORICO_ESTADOS_PEDIDO ADD CONSTRAINT fk_historico_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE HISTORICO_ESTADOS_PEDIDO ADD CONSTRAINT fk_historico_usuario FOREIGN KEY (ID_Usuario) REFERENCES USUARIO(ID_Usuario);
ALTER TABLE DOCUMENTOS_TRIBUTARIOS ADD CONSTRAINT fk_documento_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE DOCUMENTOS_TRIBUTARIOS ADD CONSTRAINT fk_documento_divisa FOREIGN KEY (ID_Divisa) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE DOCUMENTOS_TRIBUTARIOS ADD CONSTRAINT fk_documento_contador FOREIGN KEY (ID_Contador) REFERENCES CONTADOR(ID_Contador);
ALTER TABLE PAGOS ADD CONSTRAINT fk_pago_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE PAGOS ADD CONSTRAINT fk_pago_contador FOREIGN KEY (ID_Contador) REFERENCES CONTADOR(ID_Contador);
ALTER TABLE PAGOS ADD CONSTRAINT fk_pago_divisa FOREIGN KEY (ID_Divisa) REFERENCES DIVISAS(ID_Divisa);
ALTER TABLE WEBPAY_TRANSACCIONES ADD CONSTRAINT fk_webpay_pago FOREIGN KEY (ID_Pago) REFERENCES PAGOS(ID_Pago);

-- RELACIONES DE DEVOLUCIONES
ALTER TABLE DEVOLUCIONES ADD CONSTRAINT fk_devolucion_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE DEVOLUCIONES ADD CONSTRAINT fk_devolucion_cliente FOREIGN KEY (ID_Cliente) REFERENCES CLIENTE(ID_Cliente);
ALTER TABLE DEVOLUCIONES ADD CONSTRAINT fk_devolucion_vendedor FOREIGN KEY (ID_Vendedor) REFERENCES VENDEDOR(ID_Vendedor);
ALTER TABLE DETALLES_DEVOLUCION ADD CONSTRAINT fk_detdev_devolucion FOREIGN KEY (ID_Devolucion) REFERENCES DEVOLUCIONES(ID_Devolucion);
ALTER TABLE DETALLES_DEVOLUCION ADD CONSTRAINT fk_detdev_detallepedido FOREIGN KEY (ID_Detalle_Pedido) REFERENCES DETALLES_PEDIDO(ID_Detalle);
ALTER TABLE DETALLES_DEVOLUCION ADD CONSTRAINT fk_detdev_producto FOREIGN KEY (ID_Producto_Reemplazo) REFERENCES PRODUCTOS(ID_Producto);
ALTER TABLE MOVIMIENTOS_INVENTARIO ADD CONSTRAINT fk_movimiento_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE MOVIMIENTOS_INVENTARIO ADD CONSTRAINT fk_movimiento_devolucion FOREIGN KEY (ID_Devolucion) REFERENCES DEVOLUCIONES(ID_Devolucion);

-- RELACIONES DE LOGÍSTICA
ALTER TABLE TRANSPORTISTAS ADD CONSTRAINT fk_transportista_empresa FOREIGN KEY (ID_Empresa) REFERENCES EMPRESA_TRANSPORTE(ID_Empresa);
ALTER TABLE ENVIOS ADD CONSTRAINT fk_envio_pedido FOREIGN KEY (ID_Pedido) REFERENCES PEDIDOS(ID_Pedido);
ALTER TABLE ENVIOS ADD CONSTRAINT fk_envio_transportista FOREIGN KEY (ID_Transportista) REFERENCES TRANSPORTISTAS(ID_Transportista);
ALTER TABLE SEGUIMIENTO_ENVIO ADD CONSTRAINT fk_seguimiento_envio FOREIGN KEY (ID_Envio) REFERENCES ENVIOS(ID_Envio);
ALTER TABLE SEGUIMIENTO_ENVIO ADD CONSTRAINT fk_seguimiento_transportista FOREIGN KEY (ID_Transportista) REFERENCES TRANSPORTISTAS(ID_Transportista);

-- RELACIONES DE MARKETING
ALTER TABLE PROMOCIONES ADD CONSTRAINT fk_promocion_categoria FOREIGN KEY (ID_Categoria) REFERENCES CATEGORIAS(ID_Categoria);
ALTER TABLE PROMOCIONES ADD CONSTRAINT fk_promocion_admin FOREIGN KEY (ID_Administrador) REFERENCES ADMINISTRADOR(ID_Administrador);
ALTER TABLE PRODUCTOS_PROMOCION ADD CONSTRAINT fk_prodprom_promocion FOREIGN KEY (ID_Promocion) REFERENCES PROMOCIONES(ID_Promocion);
ALTER TABLE PRODUCTOS_PROMOCION ADD CONSTRAINT fk_prodprom_producto FOREIGN KEY (ID_Producto) REFERENCES PRODUCTOS(ID_Producto);
ALTER TABLE CONTACTOS_CLIENTE ADD CONSTRAINT fk_contacto_cliente FOREIGN KEY (ID_Cliente) REFERENCES CLIENTE(ID_Cliente);
ALTER TABLE CONTACTOS_CLIENTE ADD CONSTRAINT fk_contacto_vendedor FOREIGN KEY (ID_Vendedor) REFERENCES VENDEDOR(ID_Vendedor);
ALTER TABLE SUSCRIPCIONES_NEWSLETTER ADD CONSTRAINT fk_suscripcion_cliente FOREIGN KEY (ID_Cliente) REFERENCES CLIENTE(ID_Cliente);

-- RELACIONES DE SISTEMA
ALTER TABLE INFORMES ADD CONSTRAINT fk_informe_admin FOREIGN KEY (ID_Administrador) REFERENCES ADMINISTRADOR(ID_Administrador);
ALTER TABLE INFORMES ADD CONSTRAINT fk_informe_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE API_KEYS ADD CONSTRAINT fk_apikey_sucursal FOREIGN KEY (ID_Sucursal) REFERENCES SUCURSALES(ID_Sucursal);
ALTER TABLE API_REQUESTS_LOG ADD CONSTRAINT fk_apilog_apikey FOREIGN KEY (ID_API_Key) REFERENCES API_KEYS(ID_API_Key);
ALTER TABLE CONFIGURACION_SISTEMA ADD CONSTRAINT fk_config_admin FOREIGN KEY (ID_Administrador) REFERENCES ADMINISTRADOR(ID_Administrador);